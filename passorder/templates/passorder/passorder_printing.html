{% extends 'base.html' %}
{% load static %}
{% block title %}ν¨μ¤μ¤λ” ν”„λ¦°ν…{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="text-center mb-4">
        <h1 class="fw-bold display-5">ν¨μ¤μ¤λ” ν”„λ¦°νΈ</h1>
        <p class="text-muted">μ£Όλ¬Έ λ²νΈ: <strong>{{ order.id }}</strong></p>
    </div>

    <div class="row justify-content-center">
        <div class="col-md-8">
            <h3 class="fw-bold">μ¶λ ¥ν•  νμΌ λ©λ΅</h3>
            {% if files %}
                <ul class="list-group">
                    {% for file in files %}
                        <li class="list-group-item">
                            <a href="{{ file.pass_order_file.url }}" target="_blank">{{ file.pass_order_file.name }}</a>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p class="text-muted">μ²¨λ¶€λ νμΌμ΄ μ—†μµλ‹λ‹¤.</p>
            {% endif %}

            <!-- μ¶λ ¥ μ „ μ£Όμμ‚¬ν•­ -->
            <div class="card border-danger shadow-sm mt-4 mb-4">
                <div class="card-header bg-danger bg-opacity-10 border-danger text-center py-3">
                    <i class="fas fa-exclamation-triangle fs-2 text-danger mb-2"></i>
                    <h4 class="fw-bold text-danger mb-0">β οΈ μ¶λ ¥ μ „ λ°λ“μ‹ ν™•μΈν•μ‹­μ‹μ¤!</h4>
                </div>
                <div class="card-body">
                    <div class="alert alert-danger border-0 mb-3">
                        <ul class="mb-0 ps-3">
                            <li><strong>μ¶λ ¥ λ²„νΌμ„ λ„λ¥΄μ‹λ©΄ λλλ¦΄ μ μ—†μµλ‹λ‹¤.</strong></li>
                            <li>λ³µν•©κΈ°μ— μ¤λ¥κ°€ μλ” κ²½μ°, μΈμ‡„λ¬Όμ΄ μ¦‰μ‹ μ¶λ ¥λμ§€ μ•κ³  μΌμ • μ‹κ°„μ΄ μ§€λ‚ ν›„ ν•κΊΌλ²μ— μ¶λ ¥λ  μ μμµλ‹λ‹¤.</li>
                            <li><strong>μ΄λ¬ν• μƒν™©μ—μ„λ” μ¶λ ¥ μ·¨μ† λ° ν™λ¶μ΄ λ¶κ°€λ¥ν•©λ‹λ‹¤.</strong></li>
                        </ul>
                    </div>
                    
                    <div class="alert alert-warning border-0 mb-0">
                        <h6 class="fw-bold text-warning mb-2">
                            <i class="fas fa-hand-point-right me-2"></i>λ°λ“μ‹ λ³µν•©κΈ° ν™”λ©΄(ν„°μΉμ¤ν¬λ¦°)μ—μ„ μ¤λ¥ ν‘μ‹κ°€ μ—†λ”μ§€ ν™•μΈν•΄ μ£Όμ‹­μ‹μ¤.
                        </h6>
                        <ul class="mb-0 ps-3 small">
                            <li>μ¤λ¥λ” μ „μ²΄ ν™”λ©΄ λ©”μ‹μ§€λ΅ ν‘μ‹λκΈ°λ„ ν•λ©°, ν™”λ©΄ ν•λ‹¨ μ‰ν¬ μ•„μ΄μ½ μ†μ— <span class="text-warning fw-bold">β οΈ μ•„μ΄μ½</span>μΌλ΅λ§ ν‘μ‹λλ” κ²½μ°λ„ μμµλ‹λ‹¤.</li>
                            <li>λ‘ κ²½μ° λ¨λ‘ μ¶λ ¥μ΄ μ •μƒμ μΌλ΅ μ§„ν–‰λμ§€ μ•μ„ μ μμΌλ‹, <strong>μ•„μ΄μ½κ³Ό λ©”μ‹μ§€λ¥Ό λ¨λ‘ ν™•μΈν• ν›„ μ¶λ ¥ν•΄ μ£Όμ‹­μ‹μ¤.</strong></li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="text-center">
                <form method="post" action="{% url 'passorder:passorder_printing' %}" id="printForm">
                    {% csrf_token %}
                    <input type="hidden" name="order_id" value="{{ order.id }}">
                    <button type="button" class="btn btn-primary btn-lg px-5" onclick="confirmPrint()">μ¶λ ¥ν•κΈ°</button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra-script %}
<script>
function confirmPrint() {
    // κΈ°μ΅΄ λ¨λ‹¬ λ‚΄μ©μ„ μƒλ΅μ΄ λ‚΄μ©μΌλ΅ κµμ²΄
    const modalTitle = document.getElementById('confirmModalLabel');
    const modalText = document.getElementById('confirmModalText');
    const modalBody = document.querySelector('#confirmModal .modal-body');
    
    modalTitle.innerText = 'μ¤‘μ” ν™•μΈ';
    
    // λ¨λ‹¬ λ°”λ””λ¥Ό μ™„μ „ν μƒλ΅μ΄ λ‚΄μ©μΌλ΅ κµμ²΄
    modalBody.innerHTML = `
        <div class="text-center py-3">
            <div class="mb-3">
                <i class="fas fa-exclamation-triangle text-warning fs-1 mb-3"></i>
            </div>
            <div class="text-start">
                <h6 class="fw-bold text-dark mb-3">μ¶λ ¥ λ²„νΌμ„ λ„λ¥΄μ‹λ©΄:</h6>
                <ul class="text-start mb-3 ps-3">
                    <li><strong>μΈμ‡„κ°€ μ¦‰μ‹ μ§„ν–‰λλ©° λλλ¦΄ μ μ—†μµλ‹λ‹¤.</strong></li>
                    <li>λ³µν•©κΈ°μ— μ¤λ¥κ°€ μλ” κ²½μ°, μΈμ‡„λ¬Όμ΄ λ‚μ¤‘μ— μμ°¨μ μΌλ΅ μ¶λ ¥λμ–΄ <strong>μ·¨μ† λ° ν™λ¶μ΄ μ–΄λ µμµλ‹λ‹¤.</strong></li>
                </ul>
                <div class="alert alert-warning py-2 mb-0">
                    <i class="fas fa-desktop me-2"></i>
                    <strong>π“ λ³µν•©κΈ°μ— μ „μ²΄ μ¤λ¥ λ©”μ‹μ§€ λλ” ν•λ‹¨ μ•„μ΄μ½(β οΈ)μ΄ μ—†λ” κ²ƒμ„ ν™•μΈν•μ…¨μµλ‹κΉ?</strong>
                </div>
            </div>
        </div>
    `;
    
    // λ²„νΌ ν…μ¤νΈ λ³€κ²½
    const confirmBtn = document.getElementById('confirmModalBtn');
    const cancelBtn = document.querySelector('#confirmModal .btn-secondary');
    
    confirmBtn.innerText = 'μ¶λ ¥ μ§„ν–‰';
    confirmBtn.className = 'btn btn-danger px-4';
    cancelBtn.innerText = 'μ·¨μ†';
    
    // ν™•μΈ λ²„νΌ μ΄λ²¤νΈ λ¦¬μ¤λ„ κµμ²΄
    const newConfirmBtn = confirmBtn.cloneNode(true);
    confirmBtn.parentNode.replaceChild(newConfirmBtn, confirmBtn);
    
    newConfirmBtn.addEventListener('click', function() {
        const modal = bootstrap.Modal.getInstance(document.getElementById('confirmModal'));
        modal.hide();
        document.getElementById('printForm').submit();
    });
    
    // λ¨λ‹¬ ν‘μ‹
    const modal = new bootstrap.Modal(document.getElementById('confirmModal'));
    modal.show();
}
</script>
{% endblock %}
